<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="git2rdata">
<title>Optimizing Storage for Version Control • git2rdata</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Optimizing Storage for Version Control">
<meta property="og:description" content="git2rdata">
<meta property="og:image" content="https://docs.ropensci.org/git2rdata/logo.svg">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">git2rdata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.4.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">NEWS</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <a class="dropdown-item" href="../articles/plain_text.html">Getting started storing dataframes as plain text</a>
    <a class="dropdown-item" href="../articles/version_control.html">Storing dataframes under version control</a>
    <a class="dropdown-item" href="../articles/workflow.html">Potential workflow</a>
    <a class="dropdown-item" href="../articles/efficiency.html">Efficiency</a>
    <a class="dropdown-item" href="../articles/split_by.html">Large dataframes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../CONTRIBUTING.html">Contributing</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/git2rdata">
    <span class="fa fa fa fa-github"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://twitter.com/INBOVlaanderen">
    <span class="fa fa fa fa-twitter"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://www.facebook.com/pg/INBOVlaanderen">
    <span class="fa fa fa fa-facebook"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Optimizing Storage for Version Control</h1>
                        <h4 data-toc-skip class="author">Thierry Onkelinx</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/git2rdata/blob/HEAD/vignettes/version_control.Rmd" class="external-link"><code>vignettes/version_control.Rmd</code></a></small>
      <div class="d-none name"><code>version_control.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette focuses on what <code>git2rdata</code> does to make storing dataframes under version control more efficient and convenient. <code><a href="../articles/plain_text.html">vignette("plain_text", package = "git2rdata")</a></code> describes all details on the actual file format. Hence we will not discuss the <code>optimize</code> and <code>na</code> arguments to the <code><a href="../reference/write_vc.html">write_vc()</a></code> function.</p>
<p>We will not illustrate the efficiency of <code><a href="../reference/write_vc.html">write_vc()</a></code> and <code><a href="../reference/read_vc.html">read_vc()</a></code>. <code><a href="../articles/efficiency.html">vignette("efficiency", package = "git2rdata")</a></code> covers those topics.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a directory in tempdir</span></span>
<span><span class="va">root</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"git2r-"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">root</span><span class="op">)</span></span>
<span><span class="co"># Create dummy data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">20190222</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="cn">NA</span><span class="op">)</span>, <span class="fl">26</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">25</span><span class="op">)</span>,</span>
<span>  abc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  def <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">NA</span><span class="op">)</span>, <span class="fl">26</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  timestamp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2018-01-01"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2019-01-01"</span><span class="op">)</span>,</span>
<span>    length <span class="op">=</span> <span class="fl">26</span></span>
<span>  <span class="op">)</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    26 obs. of  6 variables:</span></span>
<span><span class="co">#&gt;  $ x        : chr  "V" "U" "Z" "W" ...</span></span>
<span><span class="co">#&gt;  $ y        : Factor w/ 3 levels "a","b","c": 1 2 NA NA 1 NA 2 1 NA 1 ...</span></span>
<span><span class="co">#&gt;  $ z        : int  NA 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">#&gt;  $ abc      : num  -0.382 -0.42 -0.917 0.387 -0.992 ...</span></span>
<span><span class="co">#&gt;  $ def      : logi  TRUE FALSE NA FALSE NA NA ...</span></span>
<span><span class="co">#&gt;  $ timestamp: POSIXct, format: "2018-01-01 00:00:00" "2018-01-15 14:24:00" ...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="assumptions">Assumptions<a class="anchor" aria-label="anchor" href="#assumptions"></a>
</h2>
<p>A critical assumption made by <code>git2rdata</code> is that the dataframe itself contains all information. Each row is an observation, each column is a variable. The dataframe has <code>colnames</code> but no <code>rownames</code>. This implies that two observations switching place does not alter the information content. Nor does switching two variables.</p>
<p>Version control systems like <a href="https://git-scm.com/" class="external-link">git</a>, <a href="https://subversion.apache.org/" class="external-link">subversion</a> or <a href="https://www.mercurial-scm.org/" class="external-link">mercurial</a> focus on accurately keeping track of <em>any</em> change in the files. Two observations switching place in a plain text file <em>is</em> a change, although the information content<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;&lt;em&gt;sensu&lt;/em&gt; &lt;code&gt;git2rdata&lt;/code&gt;&lt;/p&gt;"><sup>1</sup></a> doesn’t change. <code>git2rdata</code> helps the user to prepare the plain text files in such a way that any change in the version history is an actual change in the information content.</p>
</div>
<div class="section level2">
<h2 id="sorting-observations">Sorting Observations<a class="anchor" aria-label="anchor" href="#sorting-observations"></a>
</h2>
<p>Version control systems often track changes in plain text files based on row based differences. In layman’s terms they record lines removed from and inserted in the file at what location. Changing an existing line implies removing the old version and inserting the new one. The minimal example below illustrates this.</p>
<p>Original version</p>
<pre><code>A,B
1,10
2,11
3,12</code></pre>
<p>Altered version. The row containing <code>1, 10</code> moves to the last line. The row containing <code>3,12</code> changed to <code>3,0</code>.</p>
<pre><code>A,B
2,11
3,0
1,10</code></pre>
<p>Diff between original and altered version. Notice than we have a deletion of two lines and two insertions.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>A,B</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="st">-1,10</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="dt">2,11</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="st">-3,12</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="va">+3,0</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="va">+1,10</span></span></code></pre></div>
<p>Ensuring that the observations are always sorted in the same way thus helps minimizing the diff. The sorted version of the same altered version looks like the example below.</p>
<pre><code>A,B
1,10
2,11
3,0</code></pre>
<p>Diff between original and the sorted alternate version. Notice that all changes revert to actual changes in the information content. Another benefit is that changes are easily spotted in the diff. A deletion without insertion on the next line is a removed observation. An insertion without preceding deletion is a new observation. A deletion followed by an insertion is an updated observation.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>A,B</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="dt">1,10</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="dt">2,11</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="st">-3,12</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="va">+3,0</span></span></code></pre></div>
<p>This is where the <code>sorting</code> argument comes into play. If this argument is not provided when writing a file for the first time, it will yield a warning about the lack of sorting. <code><a href="../reference/write_vc.html">write_vc()</a></code> then writes the observations in their current order. New versions of the file will not apply any sorting either, leaving this burden to the user. The changed hash for the data file illustrates this in the example below. The metadata hash remains the same.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ropensci.github.io/git2rdata/" class="external-link">git2rdata</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">x</span>, file <span class="op">=</span> <span class="st">"row_order"</span>, root <span class="op">=</span> <span class="va">root</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: No sorting applied.</span></span>
<span><span class="co">#&gt; Sorting is strongly recommended in combination with version control.</span></span>
<span><span class="co">#&gt; 7fed986e0f5c218e3d0a4f0cc434bd87bb1e5f82 f8350dc218051af4bafcd8872d92b1a29cbb4f31 </span></span>
<span><span class="co">#&gt;                          "row_order.tsv"                          "row_order.yml"</span></span>
<span><span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span>, file <span class="op">=</span> <span class="st">"row_order"</span>, root <span class="op">=</span> <span class="va">root</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: No sorting applied.</span></span>
<span><span class="co">#&gt; Sorting is strongly recommended in combination with version control.</span></span>
<span><span class="co">#&gt; 49be6d1703aff410e0b4472b888d7ba8ad3e3cab f8350dc218051af4bafcd8872d92b1a29cbb4f31 </span></span>
<span><span class="co">#&gt;                          "row_order.tsv"                          "row_order.yml"</span></span></code></pre></div>
<p><code>sorting</code> should contain a vector of variable names. The observations are automatically sorted along these variables. Now we get an error because the set of sorting variables has changed. The metadata stores the set of sorting variables. Changing the sorting can potentially lead to large diffs, which <code>git2rdata</code> tries to avoid as much as possible.</p>
<p>From this moment on we will store the output of <code><a href="../reference/write_vc.html">write_vc()</a></code> in an object reduce output.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"row_order"</span>, <span class="va">root</span>, sorting <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Sorting on 'y' results in ties.</span></span>
<span><span class="co">#&gt; Add extra sorting variables to ensure small diffs.</span></span>
<span><span class="co">#&gt; Error: The data was not overwritten because of the issues below.</span></span>
<span><span class="co">#&gt; See vignette('version_control', package = 'git2rdata') for more information.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - The sorting variables changed.</span></span>
<span><span class="co">#&gt;     - Sorting for the new data: 'y'.</span></span>
<span><span class="co">#&gt;     - Sorting for the old data: .</span></span></code></pre></div>
<p>Using <code>strict = FALSE</code> turns such errors into warnings and allows to update the file. Notice that we get a new warning: the variable we used for sorting resulted in ties, thus the order of the observations is not guaranteed to be stable. The solution is to use more or different variables. We’ll need <code>strict = FALSE</code> again to override the change in sorting variables.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"row_order"</span>, <span class="va">root</span>, sorting <span class="op">=</span> <span class="st">"y"</span>, strict <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Sorting on 'y' results in ties.</span></span>
<span><span class="co">#&gt; Add extra sorting variables to ensure small diffs.</span></span>
<span><span class="co">#&gt; Warning: Changes in the metadata may lead to unnecessarily large diffs.</span></span>
<span><span class="co">#&gt; See vignette('version_control', package = 'git2rdata') for more information.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - The sorting variables changed.</span></span>
<span><span class="co">#&gt;     - Sorting for the new data: 'y'.</span></span>
<span><span class="co">#&gt;     - Sorting for the old data: .</span></span>
<span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"row_order"</span>, <span class="va">root</span>, sorting <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="st">"x"</span><span class="op">)</span>, strict <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Changes in the metadata may lead to unnecessarily large diffs.</span></span>
<span><span class="co">#&gt; See vignette('version_control', package = 'git2rdata') for more information.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - The sorting variables changed.</span></span>
<span><span class="co">#&gt;     - Sorting for the new data: 'y', 'x'.</span></span>
<span><span class="co">#&gt;     - Sorting for the old data: 'y'.</span></span></code></pre></div>
<p>Once we have defined the sorting, we may omit the <code>sorting</code> argument when writing new versions. <code>write_vc</code> uses the sorting as defined in the existing metadata. It checks for potential ties. Ties results in a warning.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">print_file</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span>, <span class="va">root</span>, <span class="va">n</span> <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">root</span>, <span class="va">file</span><span class="op">)</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">fn</span>, n <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">data</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">print_file</span><span class="op">(</span><span class="st">"row_order.yml"</span>, <span class="va">root</span>, <span class="fl">7</span><span class="op">)</span></span>
<span><span class="co">#&gt; ..generic:</span></span>
<span><span class="co">#&gt;   git2rdata: 0.4.0</span></span>
<span><span class="co">#&gt;   optimize: yes</span></span>
<span><span class="co">#&gt;   NA string: NA</span></span>
<span><span class="co">#&gt;   sorting:</span></span>
<span><span class="co">#&gt;   - 'y'</span></span>
<span><span class="co">#&gt;   - x</span></span>
<span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span>, <span class="st">"row_order"</span>, <span class="va">root</span><span class="op">)</span></span>
<span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span>, <span class="st">"row_order"</span>, <span class="va">root</span>, sorting <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="st">"x"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="op">]</span>, <span class="st">"row_order"</span>, <span class="va">root</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Sorting on 'y', 'x' results in ties.</span></span>
<span><span class="co">#&gt; Add extra sorting variables to ensure small diffs.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sorting-variables">Sorting Variables<a class="anchor" aria-label="anchor" href="#sorting-variables"></a>
</h2>
<p>The order of the variables (columns) has an even bigger impact on a row based diff. Let’s revisit our minimal example. Suppose that we swap <code>A</code> and <code>B</code> from our <a href="#sorting-observations">original example</a>. The new data looks as below.</p>
<pre><code>B,A
10,1
11,2
13,3</code></pre>
<p>The resulting diff is maximal because every single row changed. Yet none of the information changed. Hence, maintaining column order is crucial when storing dataframes as plain text files under version control. The <code><a href="../articles/efficiency.html">vignette("efficiency", package = "git2rdata")</a></code> vignette illustrates this on a more realistic data set.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="st">-A,B</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="va">+B,A</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="st">-1,10</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="va">+10,1</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="st">-2,11</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="va">+11,2</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="st">-3,13</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="va">+13,3</span></span></code></pre></div>
<p>When <code><a href="../reference/write_vc.html">write_vc()</a></code> writes a dataframe for the first time, it stores the original order of the columns in the metadata. From that moment on, <code><a href="../reference/write_vc.html">write_vc()</a></code> uses the order stored in the metadata. The example below writes the same data set twice. The second version contains identical information but randomizes the order of the observations and the columns. The sorting by the internals of <code><a href="../reference/write_vc.html">write_vc()</a></code> will undo this randomization, resulting in an unchanged file.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"column_order"</span>, <span class="va">root</span>, sorting <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"abc"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 5080691e613a6927622819fa73a9cbc8c46e2442 cc8225b107710e24414dedee6fc04636ee0d82c6 </span></span>
<span><span class="co">#&gt;                       "column_order.tsv"                       "column_order.yml"</span></span>
<span><span class="fu">print_file</span><span class="op">(</span><span class="st">"column_order.tsv"</span>, <span class="va">root</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; x    y   z   abc def timestamp</span></span>
<span><span class="co">#&gt; A    1   18  0.572192852110693   0   1537470720</span></span>
<span><span class="co">#&gt; B    2   14  -1.64221062655002   0   1532424960</span></span>
<span><span class="co">#&gt; C    NA  5   0.0228713954429028  NA  1521072000</span></span>
<span><span class="co">#&gt; D    2   20  -0.683183900695259  NA  1539993600</span></span>
<span><span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, <span class="st">"column_order"</span>, <span class="va">root</span><span class="op">)</span></span>
<span><span class="co">#&gt; 5080691e613a6927622819fa73a9cbc8c46e2442 cc8225b107710e24414dedee6fc04636ee0d82c6 </span></span>
<span><span class="co">#&gt;                       "column_order.tsv"                       "column_order.yml"</span></span>
<span><span class="fu">print_file</span><span class="op">(</span><span class="st">"column_order.tsv"</span>, <span class="va">root</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; x    y   z   abc def timestamp</span></span>
<span><span class="co">#&gt; A    1   18  0.572192852110693   0   1537470720</span></span>
<span><span class="co">#&gt; B    2   14  -1.64221062655002   0   1532424960</span></span>
<span><span class="co">#&gt; C    NA  5   0.0228713954429028  NA  1521072000</span></span>
<span><span class="co">#&gt; D    2   20  -0.683183900695259  NA  1539993600</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="handling-factors-optimized">Handling Factors Optimized<a class="anchor" aria-label="anchor" href="#handling-factors-optimized"></a>
</h2>
<p><code><a href="../articles/plain_text.html">vignette("plain_text", package = "git2rdata")</a></code> and <code><a href="../articles/efficiency.html">vignette("efficiency", package = "git2rdata")</a></code> illustrate how we can store a factor more efficiently when storing their index in the data file and the indices and labels in the metadata. We take this even a bit further: what happens if new data arrives and we need an extra factor level?</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span>, stringsAsFactors <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">old</span>, <span class="st">"factor"</span>, <span class="va">root</span>, sorting <span class="op">=</span> <span class="st">"color"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ade0e1d70155140e5115f71efae4b15b27287b37 03c3898451e17cf436da59dd0e712606ea63a838 </span></span>
<span><span class="co">#&gt;                             "factor.tsv"                             "factor.yml"</span></span>
<span><span class="fu">print_file</span><span class="op">(</span><span class="st">"factor.yml"</span>, <span class="va">root</span><span class="op">)</span></span>
<span><span class="co">#&gt; ..generic:</span></span>
<span><span class="co">#&gt;   git2rdata: 0.4.0</span></span>
<span><span class="co">#&gt;   optimize: yes</span></span>
<span><span class="co">#&gt;   NA string: NA</span></span>
<span><span class="co">#&gt;   sorting: color</span></span>
<span><span class="co">#&gt;   hash: 03c3898451e17cf436da59dd0e712606ea63a838</span></span>
<span><span class="co">#&gt;   data_hash: ade0e1d70155140e5115f71efae4b15b27287b37</span></span>
<span><span class="co">#&gt; color:</span></span>
<span><span class="co">#&gt;   class: factor</span></span>
<span><span class="co">#&gt;   labels:</span></span>
<span><span class="co">#&gt;   - blue</span></span>
<span><span class="co">#&gt;   - red</span></span>
<span><span class="co">#&gt;   index:</span></span>
<span><span class="co">#&gt;   - 1</span></span>
<span><span class="co">#&gt;   - 2</span></span>
<span><span class="co">#&gt;   ordered: no</span></span></code></pre></div>
<p>Let’s add an observation with a new factor level. If we store the updated dataframe in a new file, we see that the indices are different. The factor level <code>"blue"</code> remains unchanged, but <code>"red"</code> becomes the third level and get index <code>3</code> instead of index <code>2</code>. This could lead to a large diff whereas the potential semantics (and thus the information content) are not changed.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">updated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"blue"</span><span class="op">)</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">updated</span>, <span class="st">"factor2"</span>, <span class="va">root</span>, sorting <span class="op">=</span> <span class="st">"color"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 74f0f3c72a5041344924bed321efedf45f5c5250 f2cc274714fef0b55e17ae432e99b73e5c880e2d </span></span>
<span><span class="co">#&gt;                            "factor2.tsv"                            "factor2.yml"</span></span>
<span><span class="fu">print_file</span><span class="op">(</span><span class="st">"factor2.yml"</span>, <span class="va">root</span><span class="op">)</span></span>
<span><span class="co">#&gt; ..generic:</span></span>
<span><span class="co">#&gt;   git2rdata: 0.4.0</span></span>
<span><span class="co">#&gt;   optimize: yes</span></span>
<span><span class="co">#&gt;   NA string: NA</span></span>
<span><span class="co">#&gt;   sorting: color</span></span>
<span><span class="co">#&gt;   hash: f2cc274714fef0b55e17ae432e99b73e5c880e2d</span></span>
<span><span class="co">#&gt;   data_hash: 74f0f3c72a5041344924bed321efedf45f5c5250</span></span>
<span><span class="co">#&gt; color:</span></span>
<span><span class="co">#&gt;   class: factor</span></span>
<span><span class="co">#&gt;   labels:</span></span>
<span><span class="co">#&gt;   - blue</span></span>
<span><span class="co">#&gt;   - green</span></span>
<span><span class="co">#&gt;   - red</span></span>
<span><span class="co">#&gt;   index:</span></span>
<span><span class="co">#&gt;   - 1</span></span>
<span><span class="co">#&gt;   - 2</span></span>
<span><span class="co">#&gt;   - 3</span></span>
<span><span class="co">#&gt;   ordered: no</span></span></code></pre></div>
<p>When we try to overwrite the original data with the updated version, we get an error because there is a change in factor levels and / or indices. In this specific case, we decided that the change is OK and force the writing by setting <code>strict = FALSE</code>. Notice that the original labels (<code>"blue"</code> and <code>"red"</code>) keep their index, the new level (<code>"green"</code>) gets the first available index number.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">updated</span>, <span class="st">"factor"</span>, <span class="va">root</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: The data was not overwritten because of the issues below.</span></span>
<span><span class="co">#&gt; See vignette('version_control', package = 'git2rdata') for more information.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - New factor labels for 'color'.</span></span>
<span><span class="co">#&gt; - New indices for 'color'.</span></span>
<span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">updated</span>, <span class="st">"factor"</span>, <span class="va">root</span>, strict <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Changes in the metadata may lead to unnecessarily large diffs.</span></span>
<span><span class="co">#&gt; See vignette('version_control', package = 'git2rdata') for more information.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - New factor labels for 'color'.</span></span>
<span><span class="co">#&gt; - New indices for 'color'.</span></span>
<span><span class="fu">print_file</span><span class="op">(</span><span class="st">"factor.yml"</span>, <span class="va">root</span><span class="op">)</span></span>
<span><span class="co">#&gt; ..generic:</span></span>
<span><span class="co">#&gt;   git2rdata: 0.4.0</span></span>
<span><span class="co">#&gt;   optimize: yes</span></span>
<span><span class="co">#&gt;   NA string: NA</span></span>
<span><span class="co">#&gt;   sorting: color</span></span>
<span><span class="co">#&gt;   hash: e0ed4c773b2179346042fef6f8c22c42c22a7c00</span></span>
<span><span class="co">#&gt;   data_hash: bf0c9f17b88b2e8768abc914349bb32e86503654</span></span>
<span><span class="co">#&gt; color:</span></span>
<span><span class="co">#&gt;   class: factor</span></span>
<span><span class="co">#&gt;   labels:</span></span>
<span><span class="co">#&gt;   - blue</span></span>
<span><span class="co">#&gt;   - green</span></span>
<span><span class="co">#&gt;   - red</span></span>
<span><span class="co">#&gt;   index:</span></span>
<span><span class="co">#&gt;   - 1</span></span>
<span><span class="co">#&gt;   - 3</span></span>
<span><span class="co">#&gt;   - 2</span></span>
<span><span class="co">#&gt;   ordered: no</span></span></code></pre></div>
<p>The next example removes the <code>"blue"</code> level and switches the order of the remaining levels. Notice that the meta data retains the existing indices. The order of the labels and indices reflects their new ordering.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">deleted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"green"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"green"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">deleted</span>, <span class="st">"factor"</span>, <span class="va">root</span>, sorting <span class="op">=</span> <span class="st">"color"</span>, strict <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Changes in the metadata may lead to unnecessarily large diffs.</span></span>
<span><span class="co">#&gt; See vignette('version_control', package = 'git2rdata') for more information.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - New factor labels for 'color'.</span></span>
<span><span class="co">#&gt; - New indices for 'color'.</span></span>
<span><span class="co">#&gt; 1d15f9b5c154535e2e7d2d5cb5619af7da41a066 3cadfe4021fe5e2990d0bb057100c608e3b602fa </span></span>
<span><span class="co">#&gt;                             "factor.tsv"                             "factor.yml"</span></span>
<span><span class="fu">print_file</span><span class="op">(</span><span class="st">"factor.yml"</span>, <span class="va">root</span><span class="op">)</span></span>
<span><span class="co">#&gt; ..generic:</span></span>
<span><span class="co">#&gt;   git2rdata: 0.4.0</span></span>
<span><span class="co">#&gt;   optimize: yes</span></span>
<span><span class="co">#&gt;   NA string: NA</span></span>
<span><span class="co">#&gt;   sorting: color</span></span>
<span><span class="co">#&gt;   hash: 3cadfe4021fe5e2990d0bb057100c608e3b602fa</span></span>
<span><span class="co">#&gt;   data_hash: 1d15f9b5c154535e2e7d2d5cb5619af7da41a066</span></span>
<span><span class="co">#&gt; color:</span></span>
<span><span class="co">#&gt;   class: factor</span></span>
<span><span class="co">#&gt;   labels:</span></span>
<span><span class="co">#&gt;   - red</span></span>
<span><span class="co">#&gt;   - green</span></span>
<span><span class="co">#&gt;   index:</span></span>
<span><span class="co">#&gt;   - 2</span></span>
<span><span class="co">#&gt;   - 3</span></span>
<span><span class="co">#&gt;   ordered: no</span></span></code></pre></div>
<p>Changing a factor to an ordered factor or <em>vice versa</em> will also keep existing level indices.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ordered</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"green"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"green"</span><span class="op">)</span>, ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">ordered</span>, <span class="st">"factor"</span>, <span class="va">root</span>, sorting <span class="op">=</span> <span class="st">"color"</span>, strict <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Changes in the metadata may lead to unnecessarily large diffs.</span></span>
<span><span class="co">#&gt; See vignette('version_control', package = 'git2rdata') for more information.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - 'color' changes from nominal to ordinal.</span></span>
<span><span class="co">#&gt; 1d15f9b5c154535e2e7d2d5cb5619af7da41a066 57ff604596058d60e97fbb9c93ee6869f32c1850 </span></span>
<span><span class="co">#&gt;                             "factor.tsv"                             "factor.yml"</span></span>
<span><span class="fu">print_file</span><span class="op">(</span><span class="st">"factor.yml"</span>, <span class="va">root</span><span class="op">)</span></span>
<span><span class="co">#&gt; ..generic:</span></span>
<span><span class="co">#&gt;   git2rdata: 0.4.0</span></span>
<span><span class="co">#&gt;   optimize: yes</span></span>
<span><span class="co">#&gt;   NA string: NA</span></span>
<span><span class="co">#&gt;   sorting: color</span></span>
<span><span class="co">#&gt;   hash: 57ff604596058d60e97fbb9c93ee6869f32c1850</span></span>
<span><span class="co">#&gt;   data_hash: 1d15f9b5c154535e2e7d2d5cb5619af7da41a066</span></span>
<span><span class="co">#&gt; color:</span></span>
<span><span class="co">#&gt;   class: factor</span></span>
<span><span class="co">#&gt;   labels:</span></span>
<span><span class="co">#&gt;   - red</span></span>
<span><span class="co">#&gt;   - green</span></span>
<span><span class="co">#&gt;   index:</span></span>
<span><span class="co">#&gt;   - 2</span></span>
<span><span class="co">#&gt;   - 3</span></span>
<span><span class="co">#&gt;   ordered: yes</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="relabelling-a-factor">Relabelling a Factor<a class="anchor" aria-label="anchor" href="#relabelling-a-factor"></a>
</h2>
<p>The example below will store a dataframe, relabel the factor levels and store it again using <code><a href="../reference/write_vc.html">write_vc()</a></code>. Notice the update of both the labels and the indices. Hence creating a large diff, where updating the labels would do.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">old</span>, <span class="st">"write_vc"</span>, <span class="va">root</span>, sorting <span class="op">=</span> <span class="st">"color"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ade0e1d70155140e5115f71efae4b15b27287b37 03c3898451e17cf436da59dd0e712606ea63a838 </span></span>
<span><span class="co">#&gt;                           "write_vc.tsv"                           "write_vc.yml"</span></span>
<span><span class="fu">print_file</span><span class="op">(</span><span class="st">"write_vc.yml"</span>, <span class="va">root</span><span class="op">)</span></span>
<span><span class="co">#&gt; ..generic:</span></span>
<span><span class="co">#&gt;   git2rdata: 0.4.0</span></span>
<span><span class="co">#&gt;   optimize: yes</span></span>
<span><span class="co">#&gt;   NA string: NA</span></span>
<span><span class="co">#&gt;   sorting: color</span></span>
<span><span class="co">#&gt;   hash: 03c3898451e17cf436da59dd0e712606ea63a838</span></span>
<span><span class="co">#&gt;   data_hash: ade0e1d70155140e5115f71efae4b15b27287b37</span></span>
<span><span class="co">#&gt; color:</span></span>
<span><span class="co">#&gt;   class: factor</span></span>
<span><span class="co">#&gt;   labels:</span></span>
<span><span class="co">#&gt;   - blue</span></span>
<span><span class="co">#&gt;   - red</span></span>
<span><span class="co">#&gt;   index:</span></span>
<span><span class="co">#&gt;   - 1</span></span>
<span><span class="co">#&gt;   - 2</span></span>
<span><span class="co">#&gt;   ordered: no</span></span>
<span><span class="va">relabeled</span> <span class="op">&lt;-</span> <span class="va">old</span></span>
<span><span class="co"># translate the color names to Dutch</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">relabeled</span><span class="op">$</span><span class="va">color</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blauw"</span>, <span class="st">"rood"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">relabeled</span>, <span class="st">"write_vc"</span>, <span class="va">root</span>, strict <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Changes in the metadata may lead to unnecessarily large diffs.</span></span>
<span><span class="co">#&gt; See vignette('version_control', package = 'git2rdata') for more information.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - New factor labels for 'color'.</span></span>
<span><span class="co">#&gt; - New indices for 'color'.</span></span>
<span><span class="co">#&gt; bcf85634c3b33377842b37e4d21c3546f7572055 f6730454185caeb173c6883ce56200c376975567 </span></span>
<span><span class="co">#&gt;                           "write_vc.tsv"                           "write_vc.yml"</span></span>
<span><span class="fu">print_file</span><span class="op">(</span><span class="st">"write_vc.yml"</span>, <span class="va">root</span><span class="op">)</span></span>
<span><span class="co">#&gt; ..generic:</span></span>
<span><span class="co">#&gt;   git2rdata: 0.4.0</span></span>
<span><span class="co">#&gt;   optimize: yes</span></span>
<span><span class="co">#&gt;   NA string: NA</span></span>
<span><span class="co">#&gt;   sorting: color</span></span>
<span><span class="co">#&gt;   hash: f6730454185caeb173c6883ce56200c376975567</span></span>
<span><span class="co">#&gt;   data_hash: bcf85634c3b33377842b37e4d21c3546f7572055</span></span>
<span><span class="co">#&gt; color:</span></span>
<span><span class="co">#&gt;   class: factor</span></span>
<span><span class="co">#&gt;   labels:</span></span>
<span><span class="co">#&gt;   - blauw</span></span>
<span><span class="co">#&gt;   - rood</span></span>
<span><span class="co">#&gt;   index:</span></span>
<span><span class="co">#&gt;   - 3</span></span>
<span><span class="co">#&gt;   - 4</span></span>
<span><span class="co">#&gt;   ordered: no</span></span></code></pre></div>
<p>We created <code><a href="../reference/relabel.html">relabel()</a></code>, which changes the labels in the meta data while maintaining their indices. It takes three arguments: the name of the data file, the root and the change. <code>change</code> accepts two formats, a list or a dataframe. The name of the list must match with the variable name of a factor in the data. Each element of the list must be a named vector, the name being the existing label and the value the new label. The dataframe format requires a <code>factor</code>, <code>old</code> and <code>new</code> variable with one row for each change in label.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/write_vc.html">write_vc</a></span><span class="op">(</span><span class="va">old</span>, <span class="st">"relabel"</span>, <span class="va">root</span>, sorting <span class="op">=</span> <span class="st">"color"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ade0e1d70155140e5115f71efae4b15b27287b37 03c3898451e17cf436da59dd0e712606ea63a838 </span></span>
<span><span class="co">#&gt;                            "relabel.tsv"                            "relabel.yml"</span></span>
<span><span class="fu"><a href="../reference/relabel.html">relabel</a></span><span class="op">(</span><span class="st">"relabel"</span>, <span class="va">root</span>, change <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>red <span class="op">=</span> <span class="st">"rood"</span>, blue <span class="op">=</span> <span class="st">"blauw"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">print_file</span><span class="op">(</span><span class="st">"relabel.yml"</span>, <span class="va">root</span><span class="op">)</span></span>
<span><span class="co">#&gt; ..generic:</span></span>
<span><span class="co">#&gt;   git2rdata: 0.4.0</span></span>
<span><span class="co">#&gt;   optimize: yes</span></span>
<span><span class="co">#&gt;   NA string: NA</span></span>
<span><span class="co">#&gt;   sorting: color</span></span>
<span><span class="co">#&gt;   hash: bb25c6cc455f6d8e52b7daeb176adf83d8c5b0f9</span></span>
<span><span class="co">#&gt;   data_hash: ade0e1d70155140e5115f71efae4b15b27287b37</span></span>
<span><span class="co">#&gt; color:</span></span>
<span><span class="co">#&gt;   class: factor</span></span>
<span><span class="co">#&gt;   labels:</span></span>
<span><span class="co">#&gt;   - blauw</span></span>
<span><span class="co">#&gt;   - rood</span></span>
<span><span class="co">#&gt;   index:</span></span>
<span><span class="co">#&gt;   - 1</span></span>
<span><span class="co">#&gt;   - 2</span></span>
<span><span class="co">#&gt;   ordered: no</span></span>
<span><span class="fu"><a href="../reference/relabel.html">relabel</a></span><span class="op">(</span></span>
<span>  <span class="st">"relabel"</span>, <span class="va">root</span>,</span>
<span>  change <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    factor <span class="op">=</span> <span class="st">"color"</span>, old <span class="op">=</span> <span class="st">"blauw"</span>, new <span class="op">=</span> <span class="st">"blue"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">print_file</span><span class="op">(</span><span class="st">"relabel.yml"</span>, <span class="va">root</span><span class="op">)</span></span>
<span><span class="co">#&gt; ..generic:</span></span>
<span><span class="co">#&gt;   git2rdata: 0.4.0</span></span>
<span><span class="co">#&gt;   optimize: yes</span></span>
<span><span class="co">#&gt;   NA string: NA</span></span>
<span><span class="co">#&gt;   sorting: color</span></span>
<span><span class="co">#&gt;   hash: a4050f89a749abce203ae6e1fe6b41483d385c2d</span></span>
<span><span class="co">#&gt;   data_hash: ade0e1d70155140e5115f71efae4b15b27287b37</span></span>
<span><span class="co">#&gt; color:</span></span>
<span><span class="co">#&gt;   class: factor</span></span>
<span><span class="co">#&gt;   labels:</span></span>
<span><span class="co">#&gt;   - blue</span></span>
<span><span class="co">#&gt;   - rood</span></span>
<span><span class="co">#&gt;   index:</span></span>
<span><span class="co">#&gt;   - 1</span></span>
<span><span class="co">#&gt;   - 2</span></span>
<span><span class="co">#&gt;   ordered: no</span></span></code></pre></div>
<p>A <em>caveat</em>: <code><a href="../reference/relabel.html">relabel()</a></code> does not make sense when the data file uses verbose storage. The verbose mode stores the factor labels and not their indices, in which case relabelling a label will always yield a large diff. Hence, <code><a href="../reference/relabel.html">relabel()</a></code> requires the optimized storage.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
